<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ridimensiona Immagine con Bordo</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-label {
            white-space: nowrap; /* Evita che il testo delle label vada a capo */
        }
    </style>
</head>
<body class="container mt-5">

    <h2 class="text-center mb-4">Split image to square images (for Instagram)</h2>

    <!-- Prima riga: Input Dimensione e Bordo -->
    <div class="row justify-content-center align-items-center mb-3">
		<div class="col-auto d-flex align-items-center">
            <label for="fileInput" class="form-label fw-bold me-2">JPG Image:</label>
            <input type="file" id="fileInput" accept="image/jpeg" class="form-control form-control-sm" >
        </div>
	
		<div class="col-auto d-flex align-items-center">
            <label for="sliceSize" class="form-label fw-bold me-2">Image Size</label>
            <input type="number" class="form-control" id="sliceSize" min="1" placeholder="Inserisci un numero" value="400">
        </div>
    </div>
	
    <!-- Bottone Elabora -->
    <div class="text-center mb-3">
        <button id="processBtn" class="btn btn-primary">Generate Image</button>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<hr>
	
	<div id="outputDiv" class="flex-row mx-3 justify-content-center"></div>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("fileInput");
        const sliceSizeInput = document.getElementById("sliceSize");
        const processBtn = document.getElementById("processBtn");
        const outputContainer = document.getElementById("outputDiv");
       
        processBtn.addEventListener("click", function () {
            const file = fileInput.files[0];
            const sliceSize = parseInt(sliceSizeInput.value);
            
            if (!file || isNaN(sliceSize) || sliceSize <= 0) {
                alert("Seleziona un'immagine valida e inserisci una dimensione valida.");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.onload = function () {
                    const aspectRatio = img.width / img.height;
                    const newHeight = sliceSize;
                    const newWidth = Math.ceil(aspectRatio * newHeight);
                    
                    const resizedCanvas = document.createElement("canvas");
                    const resizedCtx = resizedCanvas.getContext("2d");
                    resizedCanvas.width = newWidth;
                    resizedCanvas.height = newHeight;
                    
                    resizedCtx.fillStyle = "white";
                    resizedCtx.fillRect(0, 0, newWidth, newHeight);
                    
                    const imgScaledWidth = newHeight * aspectRatio;
                    const offsetX = Math.ceil((newWidth - imgScaledWidth) / 2);
                    resizedCtx.drawImage(img, offsetX, 0, imgScaledWidth, newHeight);
                    
                    const numSlices = Math.ceil(newWidth / sliceSize);
                    outputContainer.innerHTML = "";
                    
                    for (let i = 0; i < numSlices; i++) {
                        const canvas = document.createElement("canvas");
                        canvas.width = sliceSize;
                        canvas.height = sliceSize;
                        canvas.classList.add("mx-2");

                        const ctx = canvas.getContext("2d");
                        
                        ctx.fillStyle = "white";
                        ctx.fillRect(0, 0, sliceSize, sliceSize);
                        const sx = i * sliceSize;
                        ctx.drawImage(resizedCanvas, sx, 0, sliceSize, sliceSize, 0, 0, sliceSize, sliceSize);
                        
                        if (i === 0) {
                            ctx.fillStyle = "white";
                            ctx.fillRect(0, 0, offsetX, sliceSize);
                        }
                        if (i === numSlices - 1) {
                            const remainingWidth = newWidth - i * sliceSize;
                            ctx.fillStyle = "white";
                            ctx.fillRect(remainingWidth, 0, sliceSize - remainingWidth, sliceSize);
                        }
                        
                        outputContainer.appendChild(canvas);
                    }
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    });



    </script>

</body>
</html>